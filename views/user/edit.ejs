<!-- ユーザー編集画面 -->
<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta http-equiv="content-type" 
            content="text/html; charset=UTF-8">
        <title><%= title %></title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
            integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14="
            crossorigin=""/>
        <link rel="stylesheet" href="/stylesheets/leaflet.usermarker.css" />

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
        integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg="
        crossorigin=""></script>
        <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
        <script src="/javascripts/leaflet.usermarker.js"></script>
    </head>

    <body class="container" onload="init()">
        <header>
            <h1 class="display-4">
                <%= title %></h1>
        </header>
        <div role="main">
            <p><%- content %></p>
            <% if (alert_message != "") { %>
                <div class="alert alert-danger" role="alert">
                    <%= alert_message %>
                </div>
            <% } %>
            <form method="post" action="/user/edit">
                <input type="hidden" name="id" value="<%= form.id %>">
                <div class="form-group">
                    <label for="name">名前</label>
                    <input type="text" name="name" id="name" 
                        class="form-control" value="<%= form.user_name %>">
                </div>
                <div class="form-group">
                    <label for="email">EMAIL</label>
                    <input type="email" name="email" id="email" 
                        class="form-control" value="<%= form.email %>">
                </div>
                <div class="form-group">
                    <label for="pass">PASSWORD</label>
                    <p id="pass-error-message" style="color: red;">パスワードは半角英数8文字以上で入力してください。</p>
                    <input type="password" name="pass" id="pass" 
                        class="form-control" value="" placeholder="パスワードを変更する場合は入力してください" pattern="^[0-9a-zA-Z]+$">
                    <input type="checkbox" onclick="myFunction()">Show Password
                </div>
                <div class="form-group">
                    <label for="region">地域</label><br>
                    <p style="font-size: small; margin-bottom: 0;">地域はマップで位置を指定すると自動で登録されます。</p>
                    <select name="region" id="region" disabled>
                        <% for(let i in regions) { %>
                            <% let obj = regions[i] %>
                            <option value="<%= obj.id %>" <% if (obj.id == form.region_id) { %>selected<% } %>><%= obj.region_name %></option>
                        <% } %>
                    </select>
                </div>
                <div class="form-group">
                    <label for="latitude">緯度</label>
                    <input type="number" step="any" id="latitude" value="<%= form.latitude %>" class="form-control">
                    <input type="hidden" name="latitude" value="<%= form.latitude %>" id="hidden-latitude">
                </div>
                <div class="form-group">
                    <label for="longitude">緯度</label>
                    <input type="number" step="any" id="longitude" value="<%= form.longitude %>" class="form-control">
                    <input type="hidden" name="longitude" value="<%= form.longitude %>" id="hidden-longitude">
                </div>
                <p>登録位置</p>
                <div id="map"></div>
                <div class="form-group">
                    <label for="address">住所</label>
                    <input type="text" name="address" id="address" 
                        class="form-control" value="<%= form.address %>">
                </div>
                <div class="form-group">
                    <label for="bio">ひとこと</label>
                    <textarea name="bio" id="bio" cols="20" rows="10" class="form-control" ><%= form.bio %></textarea>
                </div>
                <div class="row m-5">
                    <div class="col-6">
                        <button onclick="history.back()" class="btn btn-secondary" type="button">戻る</button>
                    </div>
                    <div class="col-6 text-end">
                        <input type="submit" value="更新" class="btn btn-primary" id="update-button">
                    </div>
                </div>
                
            </form>
        </div>
        <script type="text/javascript">
            function init() {
                $("#pass-error-message").hide();
                $("#update-button").prop('disabled', false);
            }

            function myFunction() {
                var x = document.getElementById("pass");
                if (x.type === "password") {
                    x.type = "text";
                } else {
                    x.type = "password";
                }
                
            }

            $("#pass").keyup(() => {
                let pattern = /^[a-z\d]{8,100}$/i;
                if ($("#pass").val() != '') {
                    if (pattern.test($("#pass").val())) {
                        // console.log("o");
                        $("#pass-error-message").hide();
                        $("#update-button").prop('disabled', false);
                    } else {
                        $("#pass-error-message").show();
                        $("#update-button").prop('disabled', true);
                    }
                } else {
                    $("#pass-error-message").hide();
                    $("#update-button").prop('disabled', false);
                }
            })
        </script>
        <script src="/javascripts/user-edit.js"></script>
    </body>

</html>